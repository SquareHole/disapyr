<html>
<head>
    <title>Secret Capture</title>
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <style>
        /* Reserve space so overlapping elements donâ€™t shift layout */
        #contentContainer {
            position: relative;
            min-height: 250px;
        }
        /* Overlapping containers for input and result */
        #inputContainer, #resultContainer {
            position: absolute;
            width: 100%;
            top: 0;
            left: 0;
            transition: opacity 500ms;
        }
    </style>
    <script>
        // Helper to fade in an element.
        function fadeInElement(el, duration) {
            el.style.opacity = 0;
            el.style.display = 'block';
            el.style.transition = 'opacity ' + duration + 'ms';
            setTimeout(function() {
                el.style.opacity = 1;
            }, 10);
        }

        // Fade out the input container on submit.
        function handleSubmit(e) {
            var inputContainer = document.getElementById('inputContainer');
            inputContainer.style.transition = 'opacity 500ms';
            inputContainer.style.opacity = 0;
        }

        // After HTMX swaps in the response, fade in the result,
        // update the title, and add a "New secret" button.
        document.addEventListener("htmx:afterSwap", function(event){
            var resultContainer = document.getElementById('resultContainer');
            fadeInElement(resultContainer, 500);
            document.getElementById('pageTitle').textContent = 'One time link to share';
            if (!document.getElementById('newSecretBtn')) {
                var newBtn = document.createElement('button');
                newBtn.id = 'newSecretBtn';
                newBtn.textContent = 'New secret';
                newBtn.className = 'btn btn-secondary mt-3';
                newBtn.onclick = function() {
                    var resultContainer = document.getElementById('resultContainer');
                    resultContainer.style.transition = 'opacity 500ms';
                    resultContainer.style.opacity = 0;
                    setTimeout(function() {
                        resultContainer.innerHTML = '';
                        var inputContainer = document.getElementById('inputContainer');
                        inputContainer.style.opacity = 0;
                        inputContainer.style.display = 'block';
                        fadeInElement(inputContainer, 500);
                        document.getElementById('secret').value = '';
                        document.getElementById('pageTitle').textContent = 'Capture your secret';
                    }, 500);
                };
                resultContainer.appendChild(newBtn);
            }
        });
    </script>
</head>
<body>
    <div class="container d-flex justify-content-center align-items-center" style="height: 100vh;">
        <div class="text-center">
            <h1 id="pageTitle">Capture your secret</h1>
            <div id="contentContainer">
                <form id="secretForm" hx-post="/" hx-target="#resultContainer" hx-swap="innerHTML" onsubmit="handleSubmit(event)">
                    <div id="inputContainer">
                        <label for="secret">Secret:</label>
                        <textarea id="secret" name="secret" class="form-control mx-auto" rows="4" style="width: 300px;"></textarea><br>
                        <button type="submit" class="btn btn-primary">Capture</button>
                    </div>
                </form>
                <div id="resultContainer" style="opacity:0;"></div>
            </div>
        </div>
    </div>
</body>
</html>
